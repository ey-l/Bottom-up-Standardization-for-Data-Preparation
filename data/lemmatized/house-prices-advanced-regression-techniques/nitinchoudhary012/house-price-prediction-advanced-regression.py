import numpy as np
import pandas as pd
from scipy.stats import norm, skew
from scipy.special import boxcox1p
import matplotlib.pyplot as plt
import seaborn as sns
from matplotlib.pyplot import xticks
pd.set_option('display.max_columns', None)
pd.set_option('display.max_rows', None)
from sklearn.model_selection import train_test_split
from sklearn.preprocessing import StandardScaler, LabelEncoder
from sklearn.pipeline import make_pipeline
from sklearn.linear_model import LinearRegression, Ridge, Lasso
from sklearn.model_selection import GridSearchCV, KFold, cross_val_score
from sklearn.metrics import mean_squared_error
from sklearn.svm import SVR
from sklearn.ensemble import RandomForestRegressor
from xgboost import XGBRegressor
from lightgbm import LGBMRegressor
import warnings
warnings.filterwarnings('ignore')
_input1 = pd.read_csv('_data/input/house-prices-advanced-regression-techniques/train.csv')
_input1.head()
_input1.shape
_input1.describe().T
_input1.isnull().sum()
train_df = _input1.copy()
train_corr = _input1.corr()
plt.figure(figsize=(24, 24))
sns.heatmap(train_corr, annot=True, cmap='plasma')
top_50_corr = train_corr.index[abs(train_corr['SalePrice'] > 0.5)]
plt.figure(figsize=(12, 8))
top_50_corr = _input1[top_50_corr].corr()
sns.heatmap(top_50_corr, cmap='YlGnBu', annot=True)
corrmat = _input1.corr()
(f, ax) = plt.subplots(figsize=(15, 15))
sns.heatmap(corrmat, vmin=0, vmax=1, square=True, cmap='plasma', annot=True, mask=corrmat < 0.75, fmt='.1f', linecolor='black', center=0, annot_kws={'size': 7})
plt.figure(figsize=(18, 12))
plt.subplot(2, 2, 1)
sns.countplot(x='MSSubClass', data=_input1)
plt.subplot(2, 2, 2)
sns.countplot(x='MSZoning', data=_input1)
plt.subplot(2, 2, 3)
sns.countplot(x='Street', data=_input1)
plt.subplot(2, 2, 4)
sns.countplot(x='Alley', data=_input1)
plt.figure(figsize=(18, 12))
plt.subplot(2, 2, 1)
sns.countplot(x='LotShape', data=_input1)
plt.subplot(2, 2, 2)
sns.countplot(x='LandContour', data=_input1)
plt.subplot(2, 2, 3)
sns.countplot(x='Utilities', data=_input1)
plt.subplot(2, 2, 4)
sns.countplot(x='LotConfig', data=_input1)
plt.figure(figsize=(18, 12))
plt.subplot(2, 2, 1)
sns.countplot(x='LandSlope', data=_input1)
plt.subplot(2, 2, 2)
sns.countplot(x='Neighborhood', data=_input1)
plt.xticks(rotation=90)
plt.subplot(2, 2, 3)
sns.countplot(x='Condition1', data=_input1)
plt.subplot(2, 2, 4)
sns.countplot(x='Condition2', data=_input1)
plt.figure(figsize=(18, 12))
plt.subplot(2, 2, 1)
sns.countplot(x='RoofStyle', data=_input1)
plt.subplot(2, 2, 2)
sns.countplot(x='RoofMatl', data=_input1)
plt.subplot(2, 2, 3)
sns.countplot(x='Exterior1st', data=_input1)
plt.xticks(rotation=90)
plt.subplot(2, 2, 4)
sns.countplot(x='Exterior2nd', data=_input1)
plt.xticks(rotation=90)
plt.figure(figsize=(18, 12))
plt.subplot(2, 2, 1)
sns.countplot(x='MasVnrType', data=_input1)
plt.subplot(2, 2, 2)
sns.countplot(x='ExterQual', data=_input1)
plt.subplot(2, 2, 3)
sns.countplot(x='ExterCond', data=_input1)
plt.subplot(2, 2, 4)
sns.countplot(x='Foundation', data=_input1)
plt.figure(figsize=(18, 12))
plt.subplot(2, 2, 1)
sns.countplot(x='BsmtQual', data=_input1)
plt.subplot(2, 2, 2)
sns.countplot(x='BsmtCond', data=_input1)
plt.subplot(2, 2, 3)
sns.countplot(x='BsmtExposure', data=_input1)
plt.subplot(2, 2, 4)
sns.countplot(x='BsmtFinType1', data=_input1)
plt.figure(figsize=(18, 12))
plt.subplot(2, 2, 1)
sns.countplot(x='GarageType', data=_input1)
plt.subplot(2, 2, 2)
sns.countplot(x='GarageFinish', data=_input1)
plt.subplot(2, 2, 3)
sns.countplot(x='GarageQual', data=_input1)
plt.subplot(2, 2, 4)
sns.countplot(x='GarageCond', data=_input1)
plt.figure(figsize=(18, 12))
plt.subplot(1, 2, 1)
sns.countplot(x='SaleType', data=_input1)
plt.subplot(1, 2, 2)
sns.countplot(x='SaleCondition', data=_input1)
numeric_variable = _input1.select_dtypes(['float64', 'int64'])
plt.figure(figsize=(15, 10))
numeric_variable.groupby(['YearBuilt'])['SalePrice'].mean().plot(kind='line')
plt.ylabel('Mean Sales Price')
plt.figure(figsize=(14, 8))
plt.subplot(2, 2, 1)
sns.distplot(_input1['BsmtFinSF1'])
plt.subplot(2, 2, 2)
sns.distplot(_input1['BsmtFinSF2'])
plt.subplot(2, 2, 3)
sns.distplot(_input1['BsmtUnfSF'])
plt.subplot(2, 2, 4)
sns.distplot(_input1['TotalBsmtSF'])
_input1 = _input1.drop(['BsmtFinSF2'], axis=1, inplace=False)
plt.figure(figsize=(19, 5))
plt.subplot(1, 3, 1)
sns.scatterplot(x='BsmtFinSF1', y='SalePrice', data=numeric_variable)
plt.subplot(1, 3, 2)
sns.scatterplot(x='BsmtUnfSF', y='SalePrice', data=numeric_variable)
plt.subplot(1, 3, 3)
sns.scatterplot(x='TotalBsmtSF', y='SalePrice', data=numeric_variable)
plt.figure(figsize=(14, 8))
plt.subplot(2, 2, 1)
sns.distplot(numeric_variable['1stFlrSF'])
plt.subplot(2, 2, 2)
sns.distplot(numeric_variable['2ndFlrSF'])
plt.subplot(2, 2, 3)
sns.distplot(numeric_variable['LowQualFinSF'])
plt.subplot(2, 2, 4)
sns.distplot(numeric_variable['GrLivArea'])
_input1 = _input1.drop(['LowQualFinSF'], axis=1, inplace=False)
plt.figure(figsize=(16, 8))
plt.subplot(2, 2, 1)
sns.scatterplot(x='BsmtFullBath', y='SalePrice', data=numeric_variable)
plt.subplot(2, 2, 2)
sns.scatterplot(x='BsmtHalfBath', y='SalePrice', data=numeric_variable)
plt.subplot(2, 2, 3)
sns.scatterplot(x='FullBath', y='SalePrice', data=numeric_variable)
plt.subplot(2, 2, 4)
sns.scatterplot(x='HalfBath', y='SalePrice', data=numeric_variable)
plt.figure(figsize=(16, 8))
plt.subplot(2, 3, 1)
sns.distplot(numeric_variable['WoodDeckSF'])
plt.subplot(2, 3, 2)
sns.distplot(numeric_variable['OpenPorchSF'])
plt.subplot(2, 3, 3)
sns.distplot(numeric_variable['EnclosedPorch'])
plt.subplot(2, 3, 4)
sns.distplot(numeric_variable['3SsnPorch'])
plt.subplot(2, 3, 5)
sns.distplot(numeric_variable['ScreenPorch'])
plt.subplot(2, 3, 6)
sns.distplot(numeric_variable['PoolArea'])
_input1 = _input1.drop(['EnclosedPorch', '3SsnPorch', 'ScreenPorch', 'PoolArea'], axis=1, inplace=False)
sns.scatterplot(x='MiscVal', y='SalePrice', data=numeric_variable)
_input1 = _input1.drop(['MiscVal', 'Id', 'BedroomAbvGr', 'KitchenAbvGr'], axis=1, inplace=False)
count = pd.DataFrame(_input1.isnull().sum().sort_values(ascending=False), columns=['null_counts'])
percent = pd.DataFrame(round(100 * (_input1.isnull().sum() / _input1.shape[0]), 2).sort_values(ascending=False), columns=['null_percentage'])
Missing_Value_Table = pd.concat([count, percent], axis=1)
Missing_Value_Table.head(20)
high_percnt_missing_features = ['Alley', 'PoolQC', 'MiscFeature', 'Fence']
for miss in high_percnt_missing_features:
    print('Unique Values Count for {}'.format(miss))
    print(_input1[miss].value_counts(dropna=False))
    print('\n')
_input1 = _input1.drop(['Alley', 'PoolQC', 'Fence', 'MiscFeature'], axis=1, inplace=False)
_input1.shape
_input1['FireplaceQu'].value_counts(dropna=False)
_input1.loc[_input1['FireplaceQu'].isnull(), ['Fireplaces', 'FireplaceQu']].head(10)
_input1['FireplaceQu'] = _input1['FireplaceQu'].fillna('Not_Present', inplace=False)
sns.distplot(_input1['LotFrontage'].dropna())
_input1['LotFrontage'] = _input1['LotFrontage'].fillna(_input1['LotFrontage'].mean(), inplace=False)
_input1.loc[_input1['GarageType'].isnull(), ['GarageType', 'GarageYrBlt', 'GarageFinish', 'GarageCars', 'GarageArea', 'GarageQual', 'GarageCond']].head(10)
_input1.loc[_input1.GarageType.isnull(), ['GarageType', 'GarageFinish', 'GarageQual', 'GarageCond']] = 'Not_Present'
sns.distplot(_input1['GarageYrBlt'].dropna())
_input1['GarageYrBlt'] = _input1['GarageYrBlt'].fillna(2021, inplace=False)
_input1.loc[_input1.BsmtQual.isnull(), ['BsmtQual', 'BsmtCond', 'BsmtExposure', 'BsmtFinType1', 'BsmtFinType2']] = 'Not_Present'
_input1.isnull().sum()
_input1['BsmtExposure'] = _input1['BsmtExposure'].replace(np.nan, 'Not_Present', inplace=False)
_input1['BsmtFinType2'] = _input1['BsmtFinType2'].replace(np.nan, 'Not_Present', inplace=False)
_input1.loc[_input1.MasVnrArea.isnull(), ['MasVnrArea', 'MasVnrType']]
_input1.loc[_input1.MasVnrType == 'None', ['MasVnrArea', 'MasVnrType']].head()
_input1['MasVnrType'] = _input1['MasVnrType'].fillna('Not_Present', inplace=False)
_input1['MasVnrArea'] = _input1['MasVnrArea'].fillna(0, inplace=False)
_input1['Electrical'].value_counts(dropna=False)
_input1['Electrical'] = _input1['Electrical'].fillna(_input1['Electrical'].mode()[0], inplace=False)
_input1.isnull().sum()
_input1['MSSubClass'] = _input1['MSSubClass'].apply(str)
_input1['OverallCond'] = _input1['OverallCond'].astype(str)
_input1['YrSold'] = _input1['YrSold'].astype(str)
_input1['MoSold'] = _input1['MoSold'].astype(str)
_input1['Street'].astype('category').value_counts()
_input1['Utilities'].astype('category').value_counts()
_input1 = _input1.drop(['Street', 'Utilities'], axis=1, inplace=False)
plt.figure(figsize=(10, 6))
sns.distplot(_input1['SalePrice'])
plt.figure(figsize=(10, 6))
sns.distplot(np.log1p(_input1.SalePrice))
_input1['SalePrice'] = np.log1p(_input1['SalePrice'])
cat_cols = ('FireplaceQu', 'BsmtQual', 'BsmtCond', 'GarageQual', 'GarageCond', 'ExterQual', 'ExterCond', 'HeatingQC', 'KitchenQual', 'BsmtFinType1', 'BsmtFinType2', 'Functional', 'BsmtExposure', 'GarageFinish', 'LandSlope', 'LotShape', 'PavedDrive', 'CentralAir', 'MSSubClass', 'OverallCond', 'YrSold', 'MoSold')
for col in cat_cols:
    lb = LabelEncoder()